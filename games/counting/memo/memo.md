# 10玉そろばん作成メモ(Alloyの良かった点メモ)

## 背景

 * iphoneで遊べる知育ゲームを作りたい
 * 足し算や引き算について
 * 楽チンそうなHaste使いたい

## スケッチ

### Object

 * ソロバンの枠(直線上にならんだ箱、サイズは玉20個分)
 * ソロバンの玉(10個、枠の中だけ移動できる、追い越し禁止)

### Operation

 * 雰囲気

```
    OOOOO@---------
           ↓
    OOOOO------@---

    OO@OO------0---
           ↓
    OO---------@OOO
```

 * 1玉の移動
   - 移動方向の玉を押しのける
   - 枠の外に玉が出ないようにする

 * 2玉の移動 -> サポート外（できなくはないが面倒）
   - ピンチアウト
       - 1玉移動と同じことを片方ずつ同時に行う
   - 片側固定ピンチイン
       - 1玉移動と同じだが、固定した部分より先は変化させない
   - ピンチイン
       - 1玉移動と同じだが、玉は指の間しか移動できない
       - 非決定的な操作がありえる
         - 最初の選択玉を優先的に移動させる
         
```
            -> <-
    OO00----@OO-@---
           ↓
    OO00-----@OO@---
           or
    OO00----@OO@----
```

### その他

 * 連続する玉(チャンク)の個数を表示したい(個数に応じてフォントを大きくしたい)
 * 玉を選択中は色を変えたい(同時に1個までしか選択できない）

## モデル考察

### Alloy

 * 実際は最初にざっと作ってからAlloy試した(最初からAlloy試せばよかった)  よかった点は
   - 性質的な記述を考えることでモデルに対する理解が深まった
      - 手続き的な記述ではなく、強制的に性質として記述させられるので新しい発見やより簡単な記述が見つかる
        - 手続き的な記述ではスラスラかける分、ついつい複雑になってしまう気がする(個人の問題)
        - 具体的には、玉を右へずらす = チャンクをずらすということに気づける
      - 仕様(テスト方法)の記述が見つかる
        - 事前条件のヒントも手に入る(指定された位置に玉がなかったらどうするの？とか)
        - 手続き的な記述ではプログラムが２つ出来ることになる. テストとしては不適切
        - とはいえ今回はその性質を使ってテストを作ったりはしなかったが（飽きた...）
          - ちゃんとやってQuickCheckにかけたかった...
      - インターフェースの引数の名前や型について考えさせられた（けど改善はしてない...)
        - 今回、玉は明示的に扱わず、格納されたリストの場所（index）として表現している
        - これだと引数だけ見てては本当に扱いたい対象が玉なのか場所なのか判断し辛い
   - 実装のアプローチが決定出来た
      - small-step vs big-step (小で大を作る vs 大は小を兼ねる)
        - 前者：1step移動を使って、複数ステップ移動を記述する
        - 後者：複数ステップ移動を最初から実装して引数に1指定することで1step移動を実現
        - 後者のメリット: 十分簡単なら後者にした方が効率面で良いことがある
        - 実際alloyで後者なアプローチを記述すると結構厳しいことになった → やっぱり前者をまず作ろう

### その他

 * 複数ステップ移動の途中で失敗する場合は最初の状態に戻すのか、行き詰まりで止めるのか??成功・失敗の判定方法は？
   * 今回は指定した場所まで移動できなければ失敗とし、状態を更新しないようにしている（GUIのイベント間隔が十分短かったので）

 * 逆問題は解けない(結果と操作した玉の移動情報だけでは元の状態を復元できない)
  - undoしたい場合(しないけど)、各操作ステップにおいて状態 or 動いた玉全ての情報を保持する必要がある

 * 右方向への操作を実装すれば、左方向への実装は反転をうまく使えばいい

## 開発に関する補足事項

 * GUI部分とモデル部分で完全に分離して開発すべき
 * まずはモデルを正しく実装する

